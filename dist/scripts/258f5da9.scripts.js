!function(){var a;a=angular.module("emeals",["restangular","blueimp.fileupload"]),a.config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/home.html"}).when("/meals/:mealId",{templateUrl:"views/show.html",controller:"MealShowCtrl",resolve:{meal:["Meals",function(a){return a.load()}]}}).when("/meals/:mealId/edit",{templateUrl:"views/edit.html",controller:"MealEditCtrl",resolve:{meal:["Meals",function(a){return a.load()}]}}).when("/plans/new",{templateUrl:"views/plan_edit.html",controller:"PlanNewCtrl"}).when("/plans/:id",{templateUrl:"views/plan.html",controller:"PlanShowCtrl",resolve:{plan:["Plans",function(a){return a.load()}]}}).when("/plans/:id/edit",{templateUrl:"views/plan_edit.html",controller:"PlanEditCtrl",resolve:{plan:["Plans",function(a){return a.load()}]}}).otherwise({redirectTo:"/"})}]),a.config(["RestangularProvider",function(a){return a.setBaseUrl("/api"),a.setRestangularFields({id:"_id"})}]),a.config(["$locationProvider",function(a){return a.html5Mode(!0)}]),_.mixin(_.string.exports())}.call(this),function(){angular.module("emeals").directive("lineList",function(){return{scope:{text:"=text"},restrict:"EA",template:'<li ng-repeat="line in lines">{{line}}</li>',replace:!0,link:function(a){var b;return a.lines=null!=(b=a.text)?b.split("\n"):void 0}}})}.call(this),function(){angular.module("emeals").directive("draggable",["$location","Navigation",function(a,b){return{restrict:"A",link:function(c,d){return d.draggable({helper:"clone",appendTo:"body",revert:!0}),c.$watch(function(){return a.path()},function(){return d.draggable("option","disabled",!b.isViewingPlans())})}}}])}.call(this),function(){var a;a=function(a){return a.attr("ng-model")?a.scope().$eval(a.attr("ng-model")):void 0},angular.module("emeals").directive("droppable",function(){return{restrict:"A",link:function(b,c,d){return c.droppable({hoverClass:"panel-success",drop:function(e,f){var g,h;return h=a(c),g=a(f.draggable),!h||!g||_.contains(_.pluck(h,"_id"),g._id)||d.droppableLimit&&h.length>=d.droppableLimit?void 0:b.$apply(function(){return h.push(g)})}})}}})}.call(this),function(){angular.module("emeals").filter("capitalize",function(){return function(a){return _.capitalize(a)}})}.call(this),function(){angular.module("emeals").filter("utcdate",["$filter",function(a){return function(b,c){var d,e,f;return null==c&&(c="mediumDate"),"string"==typeof b?(d=new Date(b),f=d.getTime(),e=6e4*d.getTimezoneOffset(),a("date")(new Date(f+e),c)):a("date")(b,c)}}])}.call(this),function(){angular.module("emeals").controller("NavigationCtrl",["$scope","Navigation",function(a,b){return a.nav=b}])}.call(this),function(){angular.module("emeals").controller("MealsListCtrl",["$scope","$routeParams","Meals","Navigation",function(a,b,c,d){var e;return e=function(){return a.meals=c.all(),a.meals.then(function(b){return a.meals=b})},e(),a.$routeParams=b,a.nav=d,a.$on("mealupdated",function(b,c){var d;return d=_.find(a.meals,{_id:c._id}),_.extend(d,c)}),a.$on("mealdeleted",function(b,c){var d;return d=_.findIndex(a.meals,{_id:c._id}),a.meals.splice(d,1)}),a.$on("fileuploaddone",e)}])}.call(this),function(){angular.module("emeals").controller("MealEditCtrl",["$scope","$rootScope","$location","meal",function(a,b,c,d){return a.meal=d,a.cancel=function(){return c.path("/meals/"+d._id)},a.save=function(){return d.put().then(function(){return b.$broadcast("mealupdated",d),c.path("/meals/"+d._id)})}}])}.call(this),function(){angular.module("emeals").controller("MealShowCtrl",["$scope","$rootScope","$location","$window","meal",function(a,b,c,d,e){return a.meal=e,a.remove=function(){return d.confirm("Are you sure you want to delete the meal?")?e.remove({_rev:e._rev}).then(function(){return b.$broadcast("mealdeleted",e),c.path("/")}):void 0}}])}.call(this),function(){angular.module("emeals").controller("DishShowCtrl",["$scope",function(a){return a.$watch("meal",function(){return a.dish=a.meal[a.type]})}])}.call(this),function(){angular.module("emeals").controller("DishEditCtrl",["$scope",function(a){return a.unitChoices=["teaspoon","tablespoon","cup","oz","lb","clove"].sort(),a.$watch("meal",function(){return a.dish=a.meal[a.type]}),a.remove=function(b){return a.dish.ingredients.splice(b,1)},a.add=function(){var b;return(b=a.dish).ingredients||(b.ingredients=[]),a.dish.ingredients.push({amount:"",unit:"",description:""})}}])}.call(this),function(){angular.module("emeals").controller("UploadCtrl",["$scope",function(a){return a.options={autoUpload:!0}}])}.call(this),function(){var a;a=function(a){return _.flatten(_.values(a.meals)).length},angular.module("emeals").controller("PlanShowCtrl",["$scope","plan","Plans",function(b,c,d){return b.plan=c,b.remove=function(a,c){return b.plan.meals[a].splice(c,1)},b.$watch("plan",function(){return b.groupedMealsByDay=_.groupBy(d.mealsByDay(b.plan),function(a,b){return Math.floor(b/3)})}),b.$watch(function(){return a(b.plan)},function(a,c){return a!==c?b.plan.put().then(function(a){return b.plan._rev=a.rev}):void 0})}])}.call(this),function(){angular.module("emeals").controller("PlanEditCtrl",["$scope","plan","$location","Plans",function(a,b,c,d){return a.plan=b,a.isNew=!1,a.mealsByDay=d.mealsByDay(b),a.$watch("plan.days",function(){return a.dayRange=d.rangeForDays(b)},!0),a.isDayHidden=function(b){return!_.contains(a.dayRange,b)},a.cancel=function(){return c.path("/plans/"+b._id)},a.save=function(){return a.plan.put().then(function(){return a.cancel()})}}])}.call(this),function(){angular.module("emeals").controller("PlanNewCtrl",["$scope","Dates","$location","Restangular",function(a,b,c,d){return a.plan={name:"",days:{start:b.today(),end:b.daysLater(6)},meals:{}},a.isNew=!0,a.cancel=function(){return c.path("/plans/current")},a.save=function(){return d.all("plans").post(a.plan).then(function(a){return c.path("/plans/"+a.id)})}}])}.call(this),function(){angular.module("emeals").factory("Navigation",["$location",function(a){return{isViewingMeals:function(){return/^\/($|meals)/.test(a.path())},isViewingPlans:function(){return/^\/plans/.test(a.path())}}}])}.call(this),function(){angular.module("emeals").factory("Dates",function(){var a;return a={format:function(a){return a.toJSON().slice(0,10)},toUTCDate:function(a){var b,c;return c=a.getTime(),b=6e4*a.getTimezoneOffset(),new Date(c-b)},today:function(){return a.format(a.toUTCDate(new Date))},daysLater:function(b){var c;return c=a.toUTCDate(new Date),c.setDate(c.getDate()+b),a.format(c)}}})}.call(this),function(){angular.module("emeals").factory("Plans",["Dates","Restangular","$route",function(a,b,c){var d;return d={load:function(){return b.one("plans",c.current.params.id).get()},rangeForDays:function(b){var c,d,e;for(c=new Date(b.days.start),e=new Date(b.days.end),d=[];e>=c&&d.length<10;)d.push(c),c=new Date(c),c.setDate(c.getDate()+1);return _.map(d,a.format)},mealsByDay:function(a){return _.map(d.rangeForDays(a),function(b){var c;return(c=a.meals)[b]||(c[b]=[]),{day:b,meals:a.meals[b]}})}}}])}.call(this),function(){angular.module("emeals").factory("Meals",["Restangular","$route",function(a,b){var c;return c={all:function(){return a.all("meals").getList()},load:function(){return a.one("meals",b.current.params.mealId).get()}}}])}.call(this);